{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ADR Schema",
  "type": "object",
  "required": ["id", "title", "status", "date", "prefix", "context"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^ADR-[A-Z]+-[0-9]{4}$"
    },
    "schema_version": {
      "type": "string",
      "enum": ["v1", "v2"]
    },
    "lint_version": {
      "type": "string",
      "enum": ["v1", "v2"]
    },
    "title": {
      "type": "string",
      "minLength": 5
    },
    "prefix": {
      "type": "string",
      "enum": ["SYS", "APP", "API", "DB", "INFRA", "SEC", "OPS", "DATA"]
    },
    "status": {
      "type": "string",
      "enum": ["Proposed", "Accepted", "Deprecated", "Superseded"]
    },
    "date": {
      "type": "string",
      "format": "date"
    },
    "context": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "description": { "type": "string" }
      },
      "additionalProperties": false
    },

    "architectural_pattern": {
      "type": "object",
      "required": ["decision_summary", "intent", "scope"],
      "properties": {
        "decision_summary": { "type": "string" },
        "intent": {
          "type": "string",
          "enum": ["scalability", "performance", "security", "governance", "cost_optimization", "reliability", "compliance"]
        },
        "scope": {
          "type": "string",
          "enum": ["system", "application", "bounded_context"]
        }
      },
      "additionalProperties": false
    },

    "infrastructure_choice": {
      "type": "object",
      "required": ["decision_summary"],
      "properties": {
        "decision_summary": { "type": "string" },
        "constraints": { "$ref": "#/properties/constraints" },
        "technical_impacts": { "$ref": "#/properties/technical_impacts" }
      },
      "additionalProperties": false
    },

    "dsl_infrastructure": {
      "type": "object",
      "required": ["decision_summary", "dsl_definition"],
      "properties": {
        "decision_summary": { "type": "string" },
        "dsl_definition": { "type": "object" },
        "enforcement": { "type": "object" }
      },
      "additionalProperties": false
    },

    "data_strategy": {
      "type": "object",
      "required": ["decision_summary"],
      "properties": {
        "decision_summary": { "type": "string" }
      },
      "additionalProperties": false
    },

    "integration_strategy": {
      "type": "object",
      "required": ["decision_summary"],
      "properties": {
        "decision_summary": { "type": "string" }
      },
      "additionalProperties": false
    },

    "security_policy": {
      "type": "object",
      "required": ["decision_summary"],
      "properties": {
        "decision_summary": { "type": "string" }
      },
      "additionalProperties": false
    },

    "governance_rule": {
      "type": "object",
      "required": ["decision_summary"],
      "properties": {
        "decision_summary": { "type": "string" },
        "rules": { "$ref": "#/properties/rules" },
        "audit_governance": { "$ref": "#/properties/audit_governance" },
        "dsl_adoption": { "type": "object" },
        "lifecycle": { "type": "object" }
      },
      "additionalProperties": false
    },

    "rules": {
      "type": "object",
      "properties": {
        "enforces": { "type": "array", "items": { "type": "string" } },
        "forbids": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },

    "constraints": {
      "type": "object",
      "properties": {
        "bounded_context": { "type": ["string", "null"] },
        "consistency_model": { "type": "string", "enum": ["strong", "eventual", "none"] },
        "transaction_scope": { "type": "string", "enum": ["local", "distributed", "none"] }
      },
      "additionalProperties": false
    },

    "related_decisions": {
      "type": "object",
      "properties": {
        "implements": { "type": "array", "items": { "type": "string" } },
        "extends": { "type": "array", "items": { "type": "string" } },
        "constrains": { "type": "array", "items": { "type": "string" } },
        "depends_on": { "type": "array", "items": { "type": "string" } },
        "supersedes": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },

    "consequences": {
      "type": "object",
      "properties": {
        "positive": { "type": "array", "items": { "type": "string" } },
        "negative": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },

    "technical_impacts": {
      "type": "object",
      "properties": {
        "affected_components": { "type": "array", "items": { "type": "string" } },
        "migrations_required": { "type": "boolean" },
        "training_required": { "type": "boolean" }
      },
      "additionalProperties": false
    },

    "audit_governance": {
      "type": "object",
      "properties": {
        "applicable": { "type": "boolean" },
        "audit_location": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    }
  },
  "anyOf": [
    { "required": ["architectural_pattern"] },
    { "required": ["infrastructure_choice"] },
    { "required": ["dsl_infrastructure"] },
    { "required": ["data_strategy"] },
    { "required": ["integration_strategy"] },
    { "required": ["security_policy"] },
    { "required": ["governance_rule"] }
  ],
  "additionalProperties": false
}